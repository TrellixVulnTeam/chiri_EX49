"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.outputtargetSchematic = exports.outputtargetGenerator = void 0;
const tslib_1 = require("tslib");
const vue_1 = require("./lib/vue");
const react_1 = require("./lib/react");
const angular_1 = require("./lib/angular");
const add_outputtarget_to_config_1 = require("./lib/add-outputtarget-to-config");
const devkit_1 = require("@nrwl/devkit");
const utillities_1 = require("../../utils/utillities");
const run_tasks_in_serial_1 = require("@nrwl/workspace/src/utilities/run-tasks-in-serial");
/*
function checkBuildable(options: AddOutputtargetSchematicSchema): Rule {
  return (tree: Tree) => {
    const workspaceJson = readJsonInTree(tree, getWorkspacePath(tree));
    const project = workspaceJson.projects[options.projectName];

    if (isStencilProjectBuilder(project, 'build')) {
      return chain([
        options.outputType === 'react' ? prepareReactLibrary(options) : noop(),
        options.outputType === 'angular'
          ? prepareAngularLibrary(options)
          : noop(),
        options.outputType === 'vue' ? prepareVueLibrary(options) : noop(),
        addToOutputTargetToConfig(options.projectName, options.outputType),
        formatFiles(),
      ]);
    } else {
      logger.info(stripIndents`
          Please use a buildable library for custom outputtargets

          You could make this library buildable with:

          nx generate @nxext/stencil:make-lib-buildable ${options.projectName}
          or
          ng generate @nxext/stencil:make-lib-buildable ${options.projectName}
        `);
      return noop();
    }
  };
}*/
function outputtargetGenerator(host, options) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const projectConfig = devkit_1.readProjectConfiguration(host, options.projectName);
        const tasks = [];
        if (utillities_1.isBuildableStencilProject(projectConfig)) {
            if (options.outputType === 'react') {
                tasks.push(yield react_1.prepareReactLibrary(host, options));
            }
            if (options.outputType === 'angular') {
                tasks.push(yield angular_1.prepareAngularLibrary(host, options));
            }
            if (options.outputType === 'vue') {
                yield vue_1.prepareVueLibrary(host, options);
            }
            yield add_outputtarget_to_config_1.addToOutputTargetToConfig(host, options.projectName, options.outputType);
            if (!options.skipFormat) {
                yield devkit_1.formatFiles(host);
            }
        }
        else {
            devkit_1.logger.info(devkit_1.stripIndents `
      Please use a buildable library for custom outputtargets

      You could make this library buildable with:

      nx generate @nxext/stencil:make-lib-buildable ${options.projectName}
      or
      ng generate @nxext/stencil:make-lib-buildable ${options.projectName}
    `);
        }
        return run_tasks_in_serial_1.runTasksInSerial(...tasks);
    });
}
exports.outputtargetGenerator = outputtargetGenerator;
exports.default = outputtargetGenerator;
exports.outputtargetSchematic = devkit_1.convertNxGenerator(outputtargetGenerator);
//# sourceMappingURL=add-outputtarget.js.map