"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.initSchematic = exports.initGenerator = void 0;
const tslib_1 = require("tslib");
const set_default_collection_1 = require("@nrwl/workspace/src/utilities/set-default-collection");
const add_style_module_dependencies_1 = require("./lib/add-style-module-dependencies");
const add_e2e_dependencies_1 = require("./lib/add-e2e-dependencies");
const add_dependencies_for_apptype_1 = require("./lib/add-dependencies-for-apptype");
const devkit_1 = require("@nrwl/devkit");
const jest_1 = require("@nrwl/jest");
const run_tasks_in_serial_1 = require("@nrwl/workspace/src/utilities/run-tasks-in-serial");
function initGenerator(host, options) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const tasks = [];
        tasks.push(add_dependencies_for_apptype_1.addDependenciesByApptype(host, options.appType));
        tasks.push(...add_style_module_dependencies_1.addStyledDependencies(host, options));
        if (options.e2eTestRunner === 'puppeteer') {
            tasks.push(...add_e2e_dependencies_1.addE2eTestDependencies(host));
        }
        if (options.unitTestRunner === 'jest') {
            tasks.push(jest_1.jestInitGenerator(host, {}));
        }
        set_default_collection_1.setDefaultCollection(host, '@nxext/stencil');
        // Nx installs Jest 27.x by default now, 'stencil test' just works with 26
        devkit_1.updateJson(host, 'package.json', pkgJson => {
            pkgJson.devDependencies['jest'] = '26.6.3';
            pkgJson.devDependencies['ts-jest'] = '26.5.6';
            return pkgJson;
        });
        if (!options.skipFormat) {
            yield devkit_1.formatFiles(host);
        }
        return run_tasks_in_serial_1.runTasksInSerial(...tasks);
    });
}
exports.initGenerator = initGenerator;
exports.initSchematic = devkit_1.convertNxGenerator(initGenerator);
//# sourceMappingURL=init.js.map