"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const schematics_1 = require("@angular-devkit/schematics");
const workspace_1 = require("@nrwl/workspace");
const migration_utils_1 = require("../utils/migration-utils");
const stencil_core_utils_1 = require("../../stencil-core-utils");
function update() {
    return schematics_1.chain([updateWorkspaceAddSchematicsOptions]);
}
exports.default = update;
function updateWorkspaceAddSchematicsOptions() {
    return workspace_1.updateWorkspaceInTree((workspaceJson, context, tree) => {
        Object.keys(workspaceJson.projects).map((k) => {
            const project = workspaceJson.projects[k];
            if (migration_utils_1.isStencilProjectBuilder(project, 'build') && !project.schematics) {
                workspaceJson.projects[k].schematics = {
                    '@nxext/stencil:component': {
                        style: calculateStyleLibrary(tree),
                        storybook: false,
                    },
                };
            }
        });
        return workspaceJson;
    });
}
function calculateStyleLibrary(tree) {
    let styleEnding = null;
    Object.keys(stencil_core_utils_1.SupportedStyles).forEach((style) => tree.visit((filePath) => {
        if (filePath.endsWith(style)) {
            styleEnding = style;
        }
    }));
    return styleEnding || 'css';
}
//# sourceMappingURL=update-0-1-0.js.map